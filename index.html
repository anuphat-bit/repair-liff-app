<!DOCTYPE html>
<html lang="th">
<head>
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>body{background-color:#f0f2f5}.container{max-width:600px}.card{border:none;box-shadow:0 4px 12px rgba(0,0,0,.08)}.section{display:none}.main-menu-button{height:80px;font-size:1.2rem;display:flex;align-items:center;justify-content:center}.back-button{cursor:pointer;color:#0d6efd;text-decoration:none}.ticket-id{font-size:1.6rem;font-weight:700;color:#0d6efd;background-color:#e7f1ff;padding:5px 15px;border-radius:8px}</style>
</head>
<body>
    <div class="container my-4">
        <div id="main-menu" class="section card"><div class="card-body p-4 text-center"><h2 class="card-title mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h2><div class="d-grid gap-3"><button id="go-to-form-btn" class="btn btn-primary main-menu-button">üìù<span class="ms-2">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</span></button><button id="go-to-status-btn" class="btn btn-outline-secondary main-menu-button">üîé<span class="ms-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span></button></div></div></div>
        <div id="repair-form-section" class="section"></div>
        <div id="status-check-section" class="section"></div>
    </div>
    <div class="modal fade" id="successModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body p-4 text-center"><img src="https://i.imgur.com/4z2Z8tG.png" width="80"><h3 class="mt-3">‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!</h3><p>‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠:</p><p id="ticket-id-display" class="ticket-id">loading...</p><p class="text-muted small mt-3">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p></div></div></div></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===================================================================
        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 2 ‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) ---
        // ===================================================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwPzth6AiS1dSn5cxFPPMdJkyQmK-XaKxpr0OheKnAjPOgcDQDp7AqGCnPSl3k5hMFI/exec"; // ‡∏ß‡∏≤‡∏á SCRIPT_URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1
        const LIFF_ID = "2008248434-1k7bSQPa"; // ‡∏ß‡∏≤‡∏á LIFF ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        // ===================================================================
        // --- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ---
        // ===================================================================
        const sections={menu:document.getElementById("main-menu"),form:document.getElementById("repair-form-section"),status:document.getElementById("status-check-section")};function showSection(e){Object.values(sections).forEach(t=>t.style.display="none"),sections[e].style.display="block"}document.addEventListener("DOMContentLoaded",()=>{liff.init({liffId:LIFF_ID}).then(()=>{loadSectionsHTML(),setupEventListeners(),showSection("menu")}).catch(e=>{document.body.innerHTML=`<div class="alert alert-danger m-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î LIFF App: ${e.message}</div>`})});function setupEventListeners(){document.getElementById("go-to-form-btn").addEventListener("click",()=>{liff.getProfile().then(e=>{document.getElementById("lineUserId").value=e.userId,document.getElementById("requesterName").value=e.displayName,showSection("form")}).catch(()=>showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ"))}),document.getElementById("go-to-status-btn").addEventListener("click",()=>showSection("status")),document.querySelectorAll(".back-button").forEach(e=>e.addEventListener("click",e=>{e.preventDefault(),showSection("menu")})),document.getElementById("repair-form").addEventListener("submit",handleFormSubmit),document.getElementById("status-form").addEventListener("submit",handleStatusCheck)}function handleFormSubmit(e){e.preventDefault();const t=document.getElementById("submit-button");t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';const n=Object.fromEntries(new FormData(e.target).entries()),o=document.getElementById("problemImage").files[0];if(o){const a=new FileReader;a.onload=e=>{n.fileData={fileName:o.name,mimeType:o.type,base64:e.target.result.split(",")[1]},sendDataToBackend(n)},a.readAsDataURL(o)}else sendDataToBackend(n)}function sendDataToBackend(e){fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify({action:"submitForm",data:e}),headers:{"Content-Type":"text/plain;charset=utf-8"}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{"success"===e.status?showSuccess(e.ticketId):showError(e.message||"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")}).catch(e=>{console.error("Fetch Error:",e),showError(e.message)})}function showSuccess(e){const t=new bootstrap.Modal(document.getElementById("successModal"));document.getElementById("ticket-id-display").innerText=e,t.show(),setTimeout(()=>{liff.isInClient()&&liff.closeWindow()},8e3)}function showError(e){alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+e);const t=document.getElementById("submit-button");t.disabled=!1,t.innerText="‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á"}function handleStatusCheck(e){e.preventDefault();const t=document.getElementById("ticketId").value.trim();if(!t)return;const n=document.getElementById("search-button");document.getElementById("status-loading").style.display="block",document.getElementById("result-card").style.display="none",document.getElementById("status-error-message").style.display="none",n.disabled=!0;const o=`${SCRIPT_URL}?action=getStatus&ticketId=${t}`;fetch(o).then(e=>e.json()).then(e=>{"found"===e.status?displayStatusResult(e.data):showStatusError(e.message)}).catch(e=>showStatusError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠")).finally(()=>{document.getElementById("status-loading").style.display="none",n.disabled=!1})}function displayStatusResult(e){document.getElementById("res-ticketId").innerText=e.ticketId,document.getElementById("res-requesterName").innerText=e.requesterName,document.getElementById("res-problemType").innerText=e.problemType,document.getElementById("res-timestamp").innerText=new Date(e.timestamp).toLocaleString("th-TH");const t=document.getElementById("res-currentStatus");t.innerText=e.currentStatus,t.className="badge","‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"===e.currentStatus?t.classList.add("bg-secondary"):"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"===e.currentStatus?t.classList.add("bg-warning","text-dark"):"‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"===e.currentStatus?t.classList.add("bg-success"):t.classList.add("bg-info","text-dark"),document.getElementById("result-card").style.display="block",document.getElementById("status-error-message").style.display="none"}function showStatusError(e){document.getElementById("status-error-message").innerText=e,document.getElementById("status-error-message").style.display="block",document.getElementById("result-card").style.display="none"}
        function loadSectionsHTML(){sections.form.innerHTML=`<div class="card"><div class="card-body p-4 p-md-5"><div class="d-flex justify-content-between align-items-center mb-4"><h2 class="card-title mb-0">‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2><a href="#" class="back-button"> &laquo; ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</a></div><form id="repair-form"><input type="hidden" id="lineUserId" name="lineUserId"><div class="mb-3"><label for="requesterName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</label><input type="text" class="form-control" id="requesterName" name="requesterName" readonly style="background-color:#e9ecef"></div><div class="row"><div class="col-md-6 mb-3"><label for="department" class="form-label">‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ù‡πà‡∏≤‡∏¢</label><input type="text" class="form-control" id="department" name="department" required></div><div class="col-md-6 mb-3"><label for="phoneNumber" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required></div></div><div class="mb-3"><label for="location" class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label><textarea class="form-control" id="location" name="location" rows="2" required></textarea></div><div class="mb-3"><label for="problemType" class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label><select class="form-select" id="problemType" name="problemType" required><option value="" disabled selected>-- ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option><option value="‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏õ‡∏≤">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏õ‡∏≤</option><option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå/IT">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå/IT</option><option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div><div class="mb-3"><label for="description" class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label><textarea class="form-control" id="description" name="description" rows="3" required></textarea></div><div class="mb-3"><label for="urgency" class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</label><select class="form-select" id="urgency" name="urgency" required><option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="‡∏î‡πà‡∏ß‡∏ô">‡∏î‡πà‡∏ß‡∏ô</option><option value="‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î">‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option></select></div><div class="mb-3"><label for="problemImage" class="form-label">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label><input type="file" class="form-control" id="problemImage" name="problemImage" accept="image/*"></div><div class="d-grid mt-4"><button type="submit" id="submit-button" class="btn btn-primary btn-lg">‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</button></div></form></div></div>`,sections.status.innerHTML=`<div class="card"><div class="card-body p-4 p-md-5"><div class="d-flex justify-content-between align-items-center mb-4"><h2 class="card-title mb-0">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h2><a href="#" class="back-button">&laquo; ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</a></div><form id="status-form"><div class="mb-3"><label for="ticketId" class="form-label">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</label><input type="text" class="form-control form-control-lg" id="ticketId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2510-0001" required></div><div class="d-grid"><button type="submit" id="search-button" class="btn btn-success btn-lg">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button></div></form></div></div><div id="status-loading" class="text-center mt-4" style="display:none"><div class="spinner-border"></div><p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</p></div><div class="card mt-4" id="result-card" style="display:none"><div class="card-header">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div><div class="card-body"><p><strong>‡∏£‡∏´‡∏±‡∏™:</strong> <span id="res-ticketId"></span></p><p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <span id="res-currentStatus" class="badge"></span></p><hr><p><strong>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</strong> <span id="res-requesterName"></span></p><p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> <span id="res-problemType"></span></p><p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong> <span id="res-timestamp"></span></p></div></div><div id="status-error-message" class="alert alert-danger mt-4" style="display:none"></div>`}
    </script>
</body>
</html>
